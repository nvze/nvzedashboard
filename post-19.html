<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GitHub Blog Writer (Dark Style)</title>
    <style>
        /* --- TEMA NVZE DARK INSPIRED --- */
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            max-width: 800px; 
            margin: 0 auto; 
            padding: 40px 20px; 
            /* Latar belakang gradient biru gelap seperti screenshot */
            background: linear-gradient(135deg, #0d1117 0%, #161b22 50%, #0a192f 100%);
            color: #e6edf3; /* Teks putih terang */
            min-height: 100vh;
        }

        h2, h3 {
            color: #ffffff;
            font-weight: 600;
            margin-bottom: 15px;
            text-align: center;
        }

        /* Gaya Kartu/Box (Glassmorphism) */
        .config-box, .control-area, #editor-wrapper { 
            background: rgba(22, 27, 34, 0.8); /* Gelap transparan */
            padding: 25px; 
            border-radius: 12px; 
            margin-bottom: 25px; 
            border: 1px solid rgba(255, 255, 255, 0.1); /* Border tipis halus */
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(10px); /* Efek blur di belakang */
        }
        
        .control-area {
            border: 1px dashed rgba(255, 255, 255, 0.2);
            background: rgba(13, 17, 23, 0.6);
        }

        /* Label & Input */
        label { 
            display: block; 
            margin-top: 15px; 
            font-weight: 500; 
            font-size: 14px; 
            color: #8b949e; /* Abu-abu agar tidak terlalu mencolok */
        }
        
        input, textarea { 
            width: 100%; 
            padding: 12px; 
            margin-top: 8px; 
            background-color: #0d1117; /* Input sangat gelap */
            border: 1px solid #30363d; 
            border-radius: 6px; 
            color: #c9d1d9; 
            font-family: monospace;
            box-sizing: border-box;
            transition: border-color 0.3s;
        }

        input:focus, textarea:focus {
            outline: none;
            border-color: #58a6ff; /* Aksen biru saat mengetik */
            box-shadow: 0 0 0 3px rgba(88, 166, 255, 0.1);
        }

        textarea { height: 400px; line-height: 1.5; font-size: 14px; }

        /* Tombol */
        button { 
            cursor: pointer; 
            padding: 12px 20px; 
            border-radius: 6px; 
            font-size: 15px; 
            font-weight: 600; 
            border: none; 
            margin-top: 15px; 
            transition: background 0.2s, transform 0.1s;
        }
        
        button:active { transform: scale(0.98); }

        .btn-check { 
            background-color: #1f6feb; /* Biru GitHub */
            color: white; 
            display: block; 
            width: 100%; 
        } 
        .btn-check:hover { background-color: #388bfd; }

        .btn-save { 
            background-color: #238636; /* Hijau GitHub */
            color: white; 
            width: 100%; 
        }
        .btn-save:hover { background-color: #2ea043; }
        
        /* Tombol Kembali (Footer) */
        .btn-back {
            display: inline-block;
            margin-top: 30px;
            color: #8b949e;
            text-decoration: none;
            border: 1px solid #30363d;
            padding: 10px 20px;
            border-radius: 6px;
            font-size: 14px;
            transition: all 0.2s;
        }
        .btn-back:hover {
            background: #21262d;
            color: #58a6ff;
            border-color: #8b949e;
        }
        .footer-nav { text-align: center; }

        /* Status & Notifikasi */
        #file-status { 
            margin-top: 15px; 
            font-weight: bold; 
            padding: 12px; 
            text-align: center; 
            border-radius: 6px;
            display: none; 
            border: 1px solid transparent;
        }
        
        #notif { 
            margin-top: 20px; 
            padding: 15px; 
            border-radius: 6px; 
            display: none; 
            text-align: center; 
            font-weight: bold;
        }

        /* Warna Status Khusus Dark Mode */
        .status-loading { background: #3c2e08; color: #e3b341; border-color: #6d581a; }
        .status-success { background: #0f2d18; color: #7ee787; border-color: #1a572a; }
        .status-new     { background: #0c2042; color: #79c0ff; border-color: #163c70; }
        .status-error   { background: #381216; color: #ff7b72; border-color: #731c22; }

        .success { background: #0f2d18; color: #7ee787; border: 1px solid #1a572a; }
        .error   { background: #381216; color: #ff7b72; border: 1px solid #731c22; }

        /* Editor Wrapper Animation */
        #editor-wrapper { 
            opacity: 0.3; 
            pointer-events: none; 
            transition: opacity 0.3s ease-in-out; 
            filter: grayscale(80%);
        }
        .active { 
            opacity: 1 !important; 
            pointer-events: auto !important; 
            filter: grayscale(0%) !important;
        }

    </style>
</head>
<body>

    <h2>üõ†Ô∏è GitHub Blog Manager</h2>

    <div class="config-box">
        <h3>1. Koneksi GitHub</h3>
        <label>Token (PAT):</label>
        <input type="password" id="token" placeholder="ghp_xxxx...">
        
        <label>Username:</label>
        <input type="text" id="username" placeholder="imamsantos">
        
        <label>Nama Repo:</label>
        <input type="text" id="repo" placeholder="blog-saya">
        
        <label>Folder (Opsional):</label>
        <input type="text" id="folder" placeholder="posts/">
    </div>

    <div class="control-area">
        <h3>2. Cek File</h3>
        <label>Nama File (wajib akhiran .html):</label>
        <input type="text" id="filename" placeholder="contoh: artikel-baru.html" oninput="resetView()">
        
        <button onclick="checkFile()" class="btn-check">üîç CEK / MUAT FILE</button>
        
        <div id="file-status"></div>
    </div>

    <div id="editor-wrapper">
        <h3>3. Tulis Konten</h3>
        <textarea id="content" placeholder="<html> Isi konten HTML blog disini... </html>"></textarea>
        
        <label>Pesan Commit:</label>
        <input type="text" id="msg" value="Update via Web Manager">

        <button onclick="saveFile()" class="btn-save">üíæ SIMPAN KE GITHUB</button>
    </div>

    <div id="notif"></div>

    <nav class="footer-nav">
        <a href="https://nvze.github.io/dashboard/blog.html" class="btn-back">‚Üê Kembali ke Dashboard</a>
    </nav>

    <script>
        let currentSha = null;

        function getDetails() {
            let folder = document.getElementById('folder').value.trim();
            if (folder && !folder.endsWith('/')) folder += '/';
            return {
                token: document.getElementById('token').value.trim(),
                user: document.getElementById('username').value.trim(),
                repo: document.getElementById('repo').value.trim(),
                path: folder + document.getElementById('filename').value.trim()
            };
        }

        async function checkFile() {
            const d = getDetails();
            const statusEl = document.getElementById('file-status');
            
            if (!d.token || !d.user || !d.repo || !document.getElementById('filename').value) {
                alert("Mohon isi Token, Username, Repo, dan Nama File!");
                return;
            }

            statusEl.style.display = 'block';
            statusEl.textContent = "‚è≥ Menghubungi GitHub...";
            statusEl.className = "status-loading"; // Class baru untuk dark mode

            try {
                const res = await fetch(`https://api.github.com/repos/${d.user}/${d.repo}/contents/${d.path}`, {
                    headers: { 'Authorization': `Bearer ${d.token}` }
                });

                const editor = document.getElementById('editor-wrapper');
                
                if (res.status === 200) { // File Ada
                    const data = await res.json();
                    currentSha = data.sha;
                    document.getElementById('content').value = decodeURIComponent(escape(window.atob(data.content.replace(/\n/g, ""))));
                    
                    statusEl.textContent = "‚úÖ File Ditemukan (Mode Edit)";
                    statusEl.className = "status-success";
                    document.getElementById('msg').value = "Update " + d.path;
                } else if (res.status === 404) { // File Baru
                    currentSha = null;
                    document.getElementById('content').value = "";
                    
                    statusEl.textContent = "‚ú® File Belum Ada (Mode Baru)";
                    statusEl.className = "status-new";
                    document.getElementById('msg').value = "Create " + d.path;
                } else {
                    throw new Error("Gagal akses (Cek Token/Repo)");
                }

                editor.classList.add('active');

            } catch (err) {
                statusEl.textContent = "‚ùå Error: " + err.message;
                statusEl.className = "status-error";
            }
        }

        async function saveFile() {
            const d = getDetails();
            const content = document.getElementById('content').value;
            const notif = document.getElementById('notif');

            if (!content) { alert("Konten kosong!"); return; }

            notif.style.display = 'block';
            notif.textContent = "Sedang menyimpan...";
            notif.className = "status-loading"; // Gunakan style loading

            const payload = {
                message: document.getElementById('msg').value,
                content: btoa(unescape(encodeURIComponent(content))),
                branch: "main"
            };
            if (currentSha) payload.sha = currentSha;

            try {
                const res = await fetch(`https://api.github.com/repos/${d.user}/${d.repo}/contents/${d.path}`, {
                    method: 'PUT',
                    headers: { 
                        'Authorization': `Bearer ${d.token}`,
                        'Content-Type': 'application/json' 
                    },
                    body: JSON.stringify(payload)
                });

                const json = await res.json();

                if (res.ok) {
                    notif.textContent = "‚úÖ Berhasil Disimpan!";
                    notif.className = "success";
                    currentSha = json.content.sha;
                } else {
                    notif.textContent = "‚ùå Gagal: " + json.message;
                    notif.className = "error";
                }
            } catch (err) {
                notif.textContent = "‚ùå Error Koneksi: " + err.message;
                notif.className = "error";
            }
        }

        function resetView() {
            document.getElementById('editor-wrapper').classList.remove('active');
            document.getElementById('file-status').style.display = 'none';
            currentSha = null;
        }
    </script>
</body>
</html>