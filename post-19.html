<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GitHub Blog Writer (Fixed)</title>
    <style>
        /* CSS Sederhana & Kuat */
        body { font-family: sans-serif; max-width: 800px; margin: 20px auto; padding: 20px; background-color: #fff; }
        
        /* Kotak Konfigurasi */
        .config-box { background: #f0f0f0; padding: 15px; border-radius: 8px; margin-bottom: 20px; border: 1px solid #ccc; }
        
        /* Elemen Input */
        label { display: block; margin-top: 10px; font-weight: bold; font-size: 14px; }
        input, textarea { width: 100%; padding: 10px; margin-top: 5px; border: 1px solid #aaa; border-radius: 4px; box-sizing: border-box; }
        textarea { height: 350px; font-family: monospace; }

        /* Tombol & Status - Layout Block (Vertikal) agar pasti muncul */
        .control-area { margin: 20px 0; padding: 15px; border: 2px dashed #ddd; border-radius: 8px; }
        
        button { cursor: pointer; padding: 12px 20px; border-radius: 5px; font-size: 16px; font-weight: bold; border: none; margin-top: 10px; }
        
        /* Tombol Biru untuk Cek */
        .btn-check { background-color: #0056b3; color: white; display: block; width: 100%; } 
        .btn-check:hover { background-color: #004494; }

        /* Tombol Hijau untuk Simpan */
        .btn-save { background-color: #28a745; color: white; width: 100%; margin-top: 10px; }
        .btn-save:hover { background-color: #218838; }

        /* Status Text */
        #file-status { margin-top: 10px; font-weight: bold; padding: 10px; text-align: center; background: #eee; display: none; }
        
        /* Notifikasi */
        #notif { margin-top: 15px; padding: 10px; border-radius: 5px; display: none; text-align: center; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }

        /* Editor Area (Dimmed saat belum dicek) */
        #editor-wrapper { opacity: 0.5; pointer-events: none; transition: 0.3s; }
        .active { opacity: 1 !important; pointer-events: auto !important; }
    </style>
</head>
<body>

    <h2>üõ†Ô∏è GitHub Blog Manager</h2>

    <div class="config-box">
        <h3>1. Koneksi GitHub</h3>
        <label>Token (PAT):</label>
        <input type="password" id="token" placeholder="ghp_xxxx...">
        
        <label>Username:</label>
        <input type="text" id="username" placeholder="imamsantos">
        
        <label>Nama Repo:</label>
        <input type="text" id="repo" placeholder="blog-saya">
        
        <label>Folder (Opsional):</label>
        <input type="text" id="folder" placeholder="posts/">
    </div>

    <div class="control-area">
        <h3>2. Cek File</h3>
        <label>Nama File (wajib akhiran .html):</label>
        <input type="text" id="filename" placeholder="contoh: artikel-baru.html" oninput="resetView()">
        
        <button onclick="checkFile()" class="btn-check">üîç CEK / MUAT FILE (Klik Disini)</button>
        
        <div id="file-status"></div>
    </div>

    <div id="editor-wrapper">
        <h3>3. Tulis Konten</h3>
        <textarea id="content" placeholder="Isi konten HTML disini..."></textarea>
        
        <label>Pesan Commit:</label>
        <input type="text" id="msg" value="Update via Web Manager">

        <button onclick="saveFile()" class="btn-save">üíæ SIMPAN KE GITHUB</button>
    </div>

    <div id="notif"></div>

    <script>
        let currentSha = null;

        function getDetails() {
            let folder = document.getElementById('folder').value.trim();
            if (folder && !folder.endsWith('/')) folder += '/';
            return {
                token: document.getElementById('token').value.trim(),
                user: document.getElementById('username').value.trim(),
                repo: document.getElementById('repo').value.trim(),
                path: folder + document.getElementById('filename').value.trim()
            };
        }

        async function checkFile() {
            const d = getDetails();
            const statusEl = document.getElementById('file-status');
            
            if (!d.token || !d.user || !d.repo || !document.getElementById('filename').value) {
                alert("Mohon isi Token, Username, Repo, dan Nama File!");
                return;
            }

            statusEl.style.display = 'block';
            statusEl.textContent = "‚è≥ Menghubungi GitHub...";
            statusEl.style.background = "#fff3cd";

            try {
                const res = await fetch(`https://api.github.com/repos/${d.user}/${d.repo}/contents/${d.path}`, {
                    headers: { 'Authorization': `Bearer ${d.token}` }
                });

                const editor = document.getElementById('editor-wrapper');
                
                if (res.status === 200) { // File Ada
                    const data = await res.json();
                    currentSha = data.sha;
                    // Decode Base64 content
                    document.getElementById('content').value = decodeURIComponent(escape(window.atob(data.content.replace(/\n/g, ""))));
                    
                    statusEl.textContent = "‚úÖ File Ditemukan (Mode Edit)";
                    statusEl.style.background = "#d1e7dd"; // Hijau
                    document.getElementById('msg').value = "Update " + d.path;
                } else if (res.status === 404) { // File Baru
                    currentSha = null;
                    document.getElementById('content').value = "";
                    
                    statusEl.textContent = "‚ú® File Belum Ada (Mode Baru)";
                    statusEl.style.background = "#cfe2ff"; // Biru
                    document.getElementById('msg').value = "Create " + d.path;
                } else {
                    throw new Error("Gagal akses (Cek Token/Repo)");
                }

                // Aktifkan Editor
                editor.classList.add('active');

            } catch (err) {
                statusEl.textContent = "‚ùå Error: " + err.message;
                statusEl.style.background = "#f8d7da";
            }
        }

        async function saveFile() {
            const d = getDetails();
            const content = document.getElementById('content').value;
            const notif = document.getElementById('notif');

            if (!content) { alert("Konten kosong!"); return; }

            notif.style.display = 'block';
            notif.textContent = "Sedang menyimpan...";
            notif.className = "";

            const payload = {
                message: document.getElementById('msg').value,
                content: btoa(unescape(encodeURIComponent(content))),
                branch: "main"
            };
            if (currentSha) payload.sha = currentSha;

            try {
                const res = await fetch(`https://api.github.com/repos/${d.user}/${d.repo}/contents/${d.path}`, {
                    method: 'PUT',
                    headers: { 
                        'Authorization': `Bearer ${d.token}`,
                        'Content-Type': 'application/json' 
                    },
                    body: JSON.stringify(payload)
                });

                const json = await res.json();

                if (res.ok) {
                    notif.textContent = "‚úÖ Berhasil Disimpan!";
                    notif.className = "success";
                    currentSha = json.content.sha; // Update SHA
                } else {
                    notif.textContent = "‚ùå Gagal: " + json.message;
                    notif.className = "error";
                }
            } catch (err) {
                notif.textContent = "‚ùå Error Koneksi: " + err.message;
                notif.className = "error";
            }
        }

        function resetView() {
            document.getElementById('editor-wrapper').classList.remove('active');
            document.getElementById('file-status').style.display = 'none';
            currentSha = null;
        }
    </script>
<p><a href="blog.html">Kembali ke daftar blog</a></p>
</body>
</html>