<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GitHub Blog Writer</title>
    <style>
        body { font-family: sans-serif; max-width: 800px; margin: 2rem auto; padding: 0 1rem; line-height: 1.6; }
        .config-box { background: #f4f4f4; padding: 1rem; border-radius: 8px; margin-bottom: 2rem; border: 1px solid #ddd; }
        label { display: block; margin-bottom: 0.5rem; font-weight: bold; }
        input, textarea { width: 100%; padding: 0.5rem; margin-bottom: 1rem; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; }
        textarea { height: 300px; font-family: monospace; }
        button { background: #2ea44f; color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; font-size: 1rem; }
        button:hover { background: #2c974b; }
        #status { margin-top: 1rem; padding: 1rem; border-radius: 4px; display: none; }
        .success { background: #d0f0c0; color: #1e561e; }
        .error { background: #f8d7da; color: #721c24; }
    </style>
</head>
<body>

    <h1>üìù Tulis Blog ke GitHub</h1>

    <div class="config-box">
        <h3>üîë Pengaturan GitHub</h3>
        <label for="token">GitHub Personal Access Token (PAT):</label>
        <input type="password" id="token" placeholder="ghp_xxxxxxxxxxxx...">
        
        <div style="display: flex; gap: 10px;">
            <div style="flex: 1;">
                <label for="username">Username:</label>
                <input type="text" id="username" placeholder="Contoh: imamsantos">
            </div>
            <div style="flex: 1;">
                <label for="repo">Nama Repository:</label>
                <input type="text" id="repo" placeholder="Contoh: blog-saya">
            </div>
        </div>
        <label for="folder">Path/Folder (Opsional):</label>
        <input type="text" id="folder" placeholder="posts/ (kosongkan jika di root)">
    </div>

    <label for="filename">Nama File (akhiri dengan .html):</label>
    <input type="text" id="filename" placeholder="artikel-baru.html">

    <label for="content">Isi Konten HTML:</label>
    <textarea id="content" placeholder="<h1>Judul Blog</h1><p>Tulisan kamu disini...</p>"></textarea>

    <button onclick="publishPost()">üöÄ Publish ke GitHub</button>

    <div id="status"></div>

    <script>
        async function publishPost() {
            const token = document.getElementById('token').value;
            const username = document.getElementById('username').value;
            const repo = document.getElementById('repo').value;
            let folder = document.getElementById('folder').value;
            const filename = document.getElementById('filename').value;
            const content = document.getElementById('content').value;
            const statusDiv = document.getElementById('status');

            // Validasi Input
            if (!token || !username || !repo || !filename || !content) {
                showStatus("Mohon lengkapi semua kolom!", "error");
                return;
            }

            // Rapikan path folder
            if (folder && !folder.endsWith('/')) folder += '/';
            
            // API Endpoint
            const path = `${folder}${filename}`;
            const url = `https://api.github.com/repos/${username}/${repo}/contents/${path}`;

            // Encoding konten ke Base64 (support UTF-8/Emoji)
            const contentEncoded = btoa(unescape(encodeURIComponent(content)));

            const data = {
                message: `‚ú® Blog baru: ${filename} via Web Interface`,
                content: contentEncoded,
                branch: "main" // Ganti 'master' jika repo lama
            };

            statusDiv.style.display = 'block';
            statusDiv.textContent = "Sedang mengirim...";
            statusDiv.className = "";

            try {
                const response = await fetch(url, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json',
                        'Accept': 'application/vnd.github.v3+json'
                    },
                    body: JSON.stringify(data)
                });

                const result = await response.json();

                if (response.ok) {
                    showStatus(`‚úÖ Berhasil! File tersimpan di: ${path}`, "success");
                    // Opsional: Bersihkan form content
                    // document.getElementById('content').value = ''; 
                } else {
                    showStatus(`‚ùå Gagal: ${result.message}`, "error");
                }
            } catch (error) {
                showStatus(`‚ùå Error Koneksi: ${error.message}`, "error");
            }
        }

        function showStatus(msg, type) {
            const el = document.getElementById('status');
            el.style.display = 'block';
            el.textContent = msg;
            el.className = type;
        }
    </script>
<a href="index.html" class="btn-back">‚Üê Kembali ke Dashboard</a>
</body>
</html>