<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NvZE Blog Manager</title>
    <style>
        /* --- THEME CONFIGURATION (Dark Navy / Fluent) --- */
        :root {
            --bg-body: #050810;
            --bg-gradient: radial-gradient(circle at top center, #1e2a45 0%, #050810 80%);
            --bg-card: rgba(30, 41, 59, 0.7);
            --bg-input: rgba(15, 23, 42, 0.8);
            --border-color: rgba(255, 255, 255, 0.1);
            --text-primary: #e2e8f0;
            --text-secondary: #94a3b8;
            --accent-blue: #3b82f6;
            --accent-hover: #2563eb;
            --success-color: #10b981;
            --danger-color: #ef4444;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background: var(--bg-body);
            background-image: var(--bg-gradient);
            color: var(--text-primary);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: flex-start;
        }

        /* --- MAIN CONTAINER (Glassmorphism) --- */
        .main-container {
            width: 100%;
            max-width: 800px;
            background: var(--bg-card);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.5);
            margin-top: 20px;
        }

        h2 {
            text-align: center;
            font-weight: 300;
            letter-spacing: 1px;
            margin-bottom: 25px;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 15px;
            color: #fff;
        }
        
        h3 { color: var(--text-secondary); font-size: 1rem; margin-top: 0; }

        /* --- INPUTS & FORMS --- */
        label { display: block; margin-top: 15px; font-size: 0.85rem; color: var(--text-secondary); margin-bottom: 5px; }
        
        input, select, textarea {
            width: 100%;
            padding: 12px;
            background: var(--bg-input);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            color: #fff;
            box-sizing: border-box;
            font-size: 14px;
            transition: 0.2s;
        }

        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: var(--accent-blue);
            box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.2);
        }

        /* Input Readonly style */
        input[readonly] { background: rgba(255,255,255,0.05); color: #777; cursor: default; }

        /* Code Editor Area */
        textarea.code-editor {
            font-family: 'Consolas', 'Monaco', monospace;
            height: 300px;
            background: #0f172a; /* Darker for code */
            color: #a5b4fc;
            line-height: 1.5;
        }

        /* --- DETAILS / CONFIG BOX --- */
        details {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            margin-bottom: 20px;
            overflow: hidden;
        }
        summary {
            padding: 15px;
            cursor: pointer;
            font-weight: 500;
            color: var(--accent-blue);
            outline: none;
            user-select: none;
        }
        summary:hover { background: rgba(255,255,255,0.02); }
        .config-box { padding: 20px; border-top: 1px solid var(--border-color); }
        .config-row { display: flex; gap: 15px; flex-wrap: wrap; }
        .config-item { flex: 1; min-width: 200px; }

        /* --- TABS --- */
        .tabs { display: flex; border-bottom: 1px solid var(--border-color); margin-bottom: 25px; }
        .tab-btn {
            background: none;
            border: none;
            padding: 15px;
            font-size: 15px;
            color: var(--text-secondary);
            cursor: pointer;
            width: 50%;
            transition: 0.3s;
            position: relative;
        }
        .tab-btn:hover { color: #fff; background: rgba(255,255,255,0.02); }
        .tab-btn.active { color: var(--accent-blue); font-weight: bold; }
        .tab-btn.active::after {
            content: ''; position: absolute; bottom: -1px; left: 0; width: 100%; height: 2px; background: var(--accent-blue);
            box-shadow: 0 -2px 10px var(--accent-blue);
        }

        /* --- ANIMATION & SECTIONS --- */
        .tab-content { display: none; animation: fadeIn 0.4s ease; }
        .tab-content.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

        /* --- BUTTONS --- */
        button {
            cursor: pointer; padding: 12px; border-radius: 6px;
            font-size: 15px; font-weight: 600; border: none; width: 100%; margin-top: 20px;
            transition: all 0.2s; letter-spacing: 0.5px;
        }
        
        .btn-check { background: linear-gradient(to right, #2563eb, #1d4ed8); color: white; } 
        .btn-check:hover { box-shadow: 0 4px 15px rgba(37, 99, 235, 0.4); }

        .btn-save { background: linear-gradient(to right, #10b981, #059669); color: white; }
        .btn-save:hover { box-shadow: 0 4px 15px rgba(16, 185, 129, 0.4); }

        .btn-publish { background: linear-gradient(to right, #6366f1, #4f46e5); color: white; }
        .btn-publish:hover { box-shadow: 0 4px 15px rgba(99, 102, 241, 0.4); }

        button:disabled { background: #334155; color: #94a3b8; cursor: not-allowed; box-shadow: none; }

        /* --- NOTIFICATIONS --- */
        .status-box { 
            margin-top: 15px; padding: 12px; border-radius: 6px; display: none; 
            text-align: center; font-size: 0.9rem; border: 1px solid transparent;
        }
        .status-loading { background: rgba(234, 179, 8, 0.1); color: #facc15; border-color: rgba(234, 179, 8, 0.2); }
        .status-success { background: rgba(16, 185, 129, 0.1); color: #34d399; border-color: rgba(16, 185, 129, 0.2); }
        .status-error { background: rgba(239, 68, 68, 0.1); color: #f87171; border-color: rgba(239, 68, 68, 0.2); }
        .status-info { background: rgba(59, 130, 246, 0.1); color: #60a5fa; border-color: rgba(59, 130, 246, 0.2); }

        /* --- EDITOR WRAPPER --- */
        #editor-wrapper { opacity: 0.4; pointer-events: none; transition: 0.3s; margin-top: 20px; border-top: 1px dashed var(--border-color); padding-top: 20px; }
        #editor-wrapper.active { opacity: 1; pointer-events: auto; }

        /* --- FOOTER --- */
        .footer-nav { margin-top: 40px; text-align: center; border-top: 1px solid var(--border-color); padding-top: 20px; }
        .btn-back {
            text-decoration: none; color: var(--text-secondary); font-size: 14px;
            display: inline-block; padding: 10px 20px; 
            background: rgba(255,255,255,0.05); border-radius: 8px; border: 1px solid var(--border-color);
            transition: 0.2s;
        }
        .btn-back:hover { background: rgba(255,255,255,0.1); color: #fff; border-color: var(--accent-blue); }

    </style>
</head>
<body>

    <div class="main-container">
        <h2>üõ†Ô∏è NvZE Posting Manager</h2>

        <details open>
            <summary>‚öôÔ∏è <b>Konfigurasi Akun</b> (Klik untuk isi)</summary>
            <div class="config-box">
                <label>GitHub Token (PAT):</label>
                <input type="password" id="global-token" placeholder="ghp_xxxx...">
                
                <div class="config-row">
                    <div class="config-item">
                        <label>Username:</label>
                        <input type="text" id="global-username" placeholder="imamsantos / nvze">
                    </div>
                    <div class="config-item">
                        <label>Nama Repo:</label>
                        <input type="text" id="global-repo" placeholder="blog-saya">
                    </div>
                </div>
            </div>
        </details>

        <div class="tabs">
            <button class="tab-btn active" onclick="switchTab('tab-editor')">üìù 1. Tulis Konten</button>
            <button class="tab-btn" onclick="switchTab('tab-publish')">üöÄ 2. Tayangkan (Index)</button>
        </div>

        <div id="tab-editor" class="tab-content active">
            <h3>Cek & Edit File HTML</h3>
            <div class="config-row">
                <div class="config-item" style="flex: 2;">
                    <label>Nama File (akhiran .html):</label>
                    <input type="text" id="ed-filename" placeholder="contoh: artikel-baru.html" oninput="resetEditorView()">
                </div>
                <div class="config-item" style="flex: 1;">
                    <label>Folder:</label>
                    <input type="text" id="ed-folder" placeholder="posts/" value="posts/">
                </div>
            </div>

            <button onclick="checkFile()" class="btn-check">üîç CEK / MUAT FILE</button>
            <div id="ed-status" class="status-box"></div>

            <div id="editor-wrapper">
                <label>Isi Konten HTML:</label>
                <textarea id="ed-content" class="code-editor" placeholder="<p>Tulis artikelmu disini...</p>"></textarea>
                
                <label>Pesan Commit:</label>
                <input type="text" id="ed-msg" value="Update via Web Manager">

                <button onclick="saveFile()" class="btn-save">üíæ SIMPAN KE GITHUB</button>
                <div id="ed-save-notif" class="status-box"></div>
            </div>
        </div>

        <div id="tab-publish" class="tab-content">
            <h3>Daftarkan Artikel ke Daftar Blog</h3>
            <div style="background: rgba(251, 191, 36, 0.1); color: #fcd34d; padding: 12px; font-size: 0.85rem; border: 1px solid rgba(251, 191, 36, 0.2); border-radius: 6px; margin-bottom: 20px;">
                ‚ö†Ô∏è Fitur ini akan mengedit file <b>blog.html</b> (atau file target) untuk menambahkan link artikel baru.
            </div>

            <label>Target File Index:</label>
            <input type="text" id="pub-targetFile" value="blog.html" readonly>

            <div class="config-row">
                <div class="config-item" style="flex: 2;">
                    <label>Judul Artikel:</label>
                    <input type="text" id="pub-title" placeholder="Contoh: Analisis Pasar Global">
                </div>
                <div class="config-item" style="flex: 1;">
                    <label>Kategori:</label>
                    <select id="pub-category">
                        <option value="ekonomi">Ekonomi</option>
                        <option value="teknologi">Teknologi</option>
                        <option value="humaniora">Humaniora</option>
                        <option value="bebas">Bebas</option>
                    </select>
                </div>
            </div>

            <div class="config-row">
                <div class="config-item">
                    <label>Tanggal:</label>
                    <input type="date" id="pub-dateInput">
                </div>
                <div class="config-item">
                    <label>Link File HTML:</label>
                    <input type="text" id="pub-link" placeholder="posts/judul-baru.html">
                </div>
            </div>

            <label>Deskripsi Singkat (Excerpt):</label>
            <textarea id="pub-desc" rows="3" placeholder="Ringkasan artikel untuk halaman depan..."></textarea>

            <button onclick="publishPost()" id="btn-pub-submit" class="btn-publish">üöÄ Posting ke Blog</button>
            
            <div id="pub-status" class="status-box"></div>
        </div>

        <nav class="footer-nav">
            <a href="https://nvze.github.io/dashboard/blog.html" class="btn-back">‚¨ÖÔ∏è Kembali ke Daftar Blog</a>
            <div style="margin-top: 15px; font-size: 0.75rem; color: #475569;">
                ¬© 2025 NVZE Dashboard System
            </div>
        </nav>
    </div>

    <script>
        // --- LOGIC UMUM & TAB ---
        let currentShaEditor = null;

        // Set tanggal hari ini otomatis saat load
        document.getElementById('pub-dateInput').valueAsDate = new Date();

        function switchTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active'));
            
            document.getElementById(tabId).classList.add('active');
            
            // Highlight button
            if(tabId === 'tab-editor') document.querySelector('.tab-btn:nth-child(1)').classList.add('active');
            else document.querySelector('.tab-btn:nth-child(2)').classList.add('active');
        }

        function getGlobalConfig() {
            const token = document.getElementById('global-token').value.trim();
            const username = document.getElementById('global-username').value.trim();
            const repo = document.getElementById('global-repo').value.trim();

            if (!token || !username || !repo) {
                alert("Mohon isi Token, Username, dan Nama Repo di bagian atas halaman!");
                return null;
            }
            return { token, username, repo };
        }

        // --- FUNGSI TAB 1: EDITOR ---

        function resetEditorView() {
            document.getElementById('editor-wrapper').classList.remove('active');
            document.getElementById('ed-status').style.display = 'none';
            document.getElementById('ed-save-notif').style.display = 'none';
            currentShaEditor = null;
        }

        async function checkFile() {
            const cfg = getGlobalConfig();
            if (!cfg) return;

            let folder = document.getElementById('ed-folder').value.trim();
            const filename = document.getElementById('ed-filename').value.trim();
            
            if (!filename) { alert("Nama file belum diisi!"); return; }
            if (folder && !folder.endsWith('/')) folder += '/';
            
            const fullPath = folder + filename;
            const statusEl = document.getElementById('ed-status');

            statusEl.style.display = 'block';
            statusEl.textContent = "‚è≥ Menghubungi GitHub...";
            statusEl.className = "status-box status-loading";

            try {
                const url = `https://api.github.com/repos/${cfg.username}/${cfg.repo}/contents/${fullPath}`;
                const res = await fetch(url, { headers: { 'Authorization': `Bearer ${cfg.token}` } });
                const editor = document.getElementById('editor-wrapper');
                
                if (res.status === 200) { // File Ada
                    const data = await res.json();
                    currentShaEditor = data.sha;
                    document.getElementById('ed-content').value = decodeURIComponent(escape(window.atob(data.content.replace(/\n/g, ""))));
                    
                    statusEl.textContent = "‚úÖ File Ditemukan (Mode Edit)";
                    statusEl.className = "status-box status-success";
                    document.getElementById('ed-msg').value = "Update " + fullPath;
                } else if (res.status === 404) { // File Baru
                    currentShaEditor = null;
                    document.getElementById('ed-content').value = "";
                    
                    statusEl.textContent = "‚ú® File Belum Ada (Mode Baru)";
                    statusEl.className = "status-box status-info";
                    document.getElementById('ed-msg').value = "Create " + fullPath;
                } else {
                    throw new Error("Gagal akses (Cek Token/Repo)");
                }
                
                editor.classList.add('active');
                
                // Helper: Auto-fill link di tab sebelah untuk kenyamanan
                document.getElementById('pub-link').value = fullPath;

            } catch (err) {
                statusEl.textContent = "‚ùå Error: " + err.message;
                statusEl.className = "status-box status-error";
            }
        }

        async function saveFile() {
            const cfg = getGlobalConfig();
            if (!cfg) return;

            const content = document.getElementById('ed-content').value;
            const notif = document.getElementById('ed-save-notif');
            let folder = document.getElementById('ed-folder').value.trim();
            if (folder && !folder.endsWith('/')) folder += '/';
            const fullPath = folder + document.getElementById('ed-filename').value.trim();

            if (!content) { alert("Konten kosong!"); return; }

            notif.style.display = 'block';
            notif.textContent = "Sedang menyimpan...";
            notif.className = "status-box status-loading";

            const payload = {
                message: document.getElementById('ed-msg').value,
                content: btoa(unescape(encodeURIComponent(content))),
                branch: "main"
            };
            if (currentShaEditor) payload.sha = currentShaEditor;

            try {
                const res = await fetch(`https://api.github.com/repos/${cfg.username}/${cfg.repo}/contents/${fullPath}`, {
                    method: 'PUT',
                    headers: { 
                        'Authorization': `Bearer ${cfg.token}`,
                        'Content-Type': 'application/json' 
                    },
                    body: JSON.stringify(payload)
                });

                const json = await res.json();

                if (res.ok) {
                    notif.textContent = "‚úÖ Berhasil Disimpan!";
                    notif.className = "status-box status-success";
                    currentShaEditor = json.content.sha;
                } else {
                    notif.textContent = "‚ùå Gagal: " + json.message;
                    notif.className = "status-box status-error";
                }
            } catch (err) {
                notif.textContent = "‚ùå Error Koneksi: " + err.message;
                notif.className = "status-box status-error";
            }
        }

        // --- FUNGSI TAB 2: PUBLISHER ---

        function formatDate(dateString) {
            const date = new Date(dateString);
            const months = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
            const day = String(date.getDate()).padStart(2, '0');
            const month = months[date.getMonth()];
            const year = date.getFullYear();
            return `${day} ${month} ${year}`;
        }

        function showPubStatus(msg, type) {
            const el = document.getElementById('pub-status');
            el.style.display = 'block';
            el.textContent = msg;
            
            if(type === 'success') el.className = "status-box status-success";
            else if(type === 'error') el.className = "status-box status-error";
            else el.className = "status-box status-loading";
        }

        async function publishPost() {
            const cfg = getGlobalConfig();
            if (!cfg) return;

            const btn = document.getElementById('btn-pub-submit');
            const targetFile = document.getElementById('pub-targetFile').value.trim();

            // Data Artikel
            const title = document.getElementById('pub-title').value;
            const cat = document.getElementById('pub-category').value;
            const rawDate = document.getElementById('pub-dateInput').value;
            const link = document.getElementById('pub-link').value;
            const desc = document.getElementById('pub-desc').value;

            if (!title || !link || !desc) {
                showPubStatus("Mohon lengkapi Judul, Link, dan Deskripsi!", "error");
                return;
            }

            const formattedDate = formatDate(rawDate);
            btn.disabled = true;
            btn.textContent = "‚è≥ Membaca database blog...";
            showPubStatus("Sedang membaca file index...", "loading");

            try {
                // 1. GET File blog.html
                const url = `https://api.github.com/repos/${cfg.username}/${cfg.repo}/contents/${targetFile}`;
                const response = await fetch(url, {
                    headers: { 'Authorization': `Bearer ${cfg.token}`, 'Accept': 'application/vnd.github.v3+json' }
                });

                if (!response.ok) throw new Error("Gagal akses file index. Cek apakah nama file benar?");
                
                const data = await response.json();
                const currentSha = data.sha;
                const oldContent = decodeURIComponent(escape(window.atob(data.content.replace(/\n/g, ""))));

                // 2. Manipulasi String
                const searchString = "const allPosts = [";
                if (!oldContent.includes(searchString)) {
                    throw new Error("Struktur 'const allPosts = [' tidak ditemukan di file target!");
                }

                const newObjectString = `
            { 
                title: "${title}", 
                cat: "${cat}", 
                date: "${formattedDate}", 
                desc: "${desc.replace(/"/g, '\\"')}", 
                link: "${link}" 
            },`;

                const newContent = oldContent.replace(searchString, searchString + newObjectString);

                // 3. PUT (Update)
                btn.textContent = "üíæ Menyimpan ke Index...";
                
                const payload = {
                    message: `New Post Index: ${title}`,
                    content: btoa(unescape(encodeURIComponent(newContent))),
                    sha: currentSha,
                    branch: "main" 
                };

                const updateRes = await fetch(url, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `Bearer ${cfg.token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(payload)
                });

                if (updateRes.ok) {
                    showPubStatus("‚úÖ Berhasil! Artikel sudah tayang di daftar blog.", "success");
                    // Bersihkan form
                    document.getElementById('pub-title').value = '';
                    document.getElementById('pub-desc').value = '';
                } else {
                    const err = await updateRes.json();
                    throw new Error(err.message);
                }

            } catch (error) {
                showPubStatus("‚ùå Error: " + error.message, "error");
            } finally {
                btn.disabled = false;
                btn.textContent = "üöÄ Posting ke Blog";
            }
        }
    </script>
</body>
</html>