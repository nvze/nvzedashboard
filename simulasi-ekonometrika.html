<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulasi Ekonometrika Indonesia Q4 2025 - REALTIME DATA</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Tambahkan Font Awesome untuk ikon -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Inter:wght@300;400;600;800&display=swap');

        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f2f5;
            color: #111827;
        }
        
        h1, h2, h3, .mono {
            font-family: 'JetBrains Mono', monospace;
        }

        .chart-wrapper {
            position: relative;
            background: white;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            padding: 1rem;
            height: 320px;
            width: 100%;
        }

        input[type=range] {
            -webkit-appearance: none;
            width: 100%;
            background: transparent;
        }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 20px;
            width: 20px;
            border-radius: 50%;
            background: #2563eb;
            cursor: pointer;
            margin-top: -8px;
            box-shadow: 0 0 2px rgba(0,0,0,0.5);
            transition: all 0.2s;
        }
        input[type=range]::-webkit-slider-thumb:hover {
            transform: scale(1.1);
            background: #1d4ed8;
        }
        input[type=range]::-webkit-slider-runnable-track {
            width: 100%;
            height: 4px;
            cursor: pointer;
            background: #cbd5e1;
            border-radius: 2px;
        }

        .metric-card {
            transition: all 0.3s ease;
        }
        .metric-card.changing {
            transform: scale(1.02);
            background-color: #eff6ff;
        }
        
        .indicator-up { color: #dc2626; }
        .indicator-down { color: #16a34a; }
        
        .gdp-up { color: #16a34a; }
        .gdp-down { color: #dc2626; }
        
        .realtime-pulse {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.6; }
            100% { opacity: 1; }
        }
        
        .data-refreshing {
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .api-status-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 6px;
        }
        
        .live-badge {
            animation: liveGlow 3s infinite;
        }
        
        @keyframes liveGlow {
            0%, 100% { box-shadow: 0 0 5px #10b981; }
            50% { box-shadow: 0 0 15px #10b981; }
        }
        
        .blink {
            animation: blink 1s infinite;
        }
        
        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }
    </style>
</head>
<body class="flex flex-col min-h-screen">

    <!-- API Status Bar -->
    <div class="bg-slate-800 text-white py-2 px-4">
        <div class="container mx-auto flex flex-wrap items-center justify-between text-xs">
            <div class="flex items-center gap-4">
                <div class="flex items-center">
                    <span class="api-status-indicator bg-green-500" id="status-kurs"></span>
                    <span>Kurs USD/IDR</span>
                </div>
                <div class="flex items-center">
                    <span class="api-status-indicator bg-green-500" id="status-fed"></span>
                    <span>Fed Rate</span>
                </div>
                <div class="flex items-center">
                    <span class="api-status-indicator bg-green-500" id="status-china"></span>
                    <span>China GDP</span>
                </div>
                <div class="flex items-center">
                    <span class="api-status-indicator bg-green-500" id="status-oil"></span>
                    <span>Brent Oil</span>
                </div>
            </div>
            <div class="flex items-center gap-3 mt-2 md:mt-0">
                <span class="text-slate-300">Auto-refresh:</span>
                <label class="relative inline-flex items-center cursor-pointer">
                    <input type="checkbox" id="auto-refresh-toggle" class="sr-only peer" checked>
                    <div class="w-8 h-4 bg-slate-600 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-3 after:w-3 after:transition-all peer-checked:bg-blue-600"></div>
                </label>
                <button onclick="fetchAllRealTimeData()" class="text-xs bg-blue-600 hover:bg-blue-700 px-3 py-1 rounded flex items-center gap-1">
                    <i class="fas fa-sync-alt" id="refresh-icon"></i>
                    Refresh Now
                </button>
                <span class="text-slate-400">Last: <span id="last-full-update">-</span></span>
            </div>
        </div>
    </div>

    <!-- Live Data Header -->
    <div class="bg-gradient-to-r from-blue-50 to-emerald-50 border-b border-slate-200">
        <div class="container mx-auto px-4 py-3">
            <div class="flex flex-col md:flex-row justify-between items-center">
                <div class="flex items-center gap-3">
                    <span class="live-badge px-3 py-1 bg-emerald-500 text-white text-xs font-bold rounded-full flex items-center gap-2">
                        <span class="realtime-pulse w-2 h-2 bg-white rounded-full"></span>
                        LIVE DATA STREAM
                    </span>
                    <div class="text-sm text-slate-700">
                        Data real-time dari sumber resmi • Update otomatis setiap 5 menit
                    </div>
                </div>
                <div class="mt-2 md:mt-0">
                    <div class="text-sm font-mono text-slate-800" id="current-datetime">Loading...</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Navbar -->
    <nav class="bg-slate-900 text-white p-4 sticky top-0 z-50 shadow-lg">
        <div class="container mx-auto flex flex-col md:flex-row justify-between items-center">
            <div class="flex items-center gap-3">
                <div class="w-8 h-8 bg-blue-600 rounded flex items-center justify-center font-bold font-mono">∑</div>
                <div>
                    <h1 class="text-lg font-bold tracking-tight">Ekonometrika RI 2025 - REALTIME DATA</h1>
                    <p class="text-xs text-slate-400">Simulator dengan integrasi data real-time global</p>
                </div>
            </div>
            <div class="mt-4 md:mt-0 text-right">
                <div class="text-xs text-slate-400 font-mono" id="data-source-info">Sumber: FRED, BI, Alpha Vantage</div>
                <div class="text-xs font-bold text-emerald-400 flex items-center gap-1">
                    <span class="realtime-pulse w-2 h-2 bg-emerald-400 rounded-full"></span>
                    MODE: REAL-TIME INTEGRATED
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Layout -->
    <main class="flex-grow container mx-auto px-4 py-8 grid grid-cols-1 lg:grid-cols-12 gap-8">

        <!-- LEFT PANEL: INPUT DRIVERS -->
        <aside class="lg:col-span-4 space-y-6">
            <div class="bg-white p-6 rounded-xl shadow-md border border-slate-200">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-lg font-bold text-slate-800">⚙️ Variabel Global (Realtime)</h2>
                    <span class="text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded">LIVE</span>
                </div>
                <p class="text-xs text-slate-500 mb-6">Data real-time diperbarui otomatis. Sesuaikan untuk simulasi "what-if".</p>

                <!-- Input 1: Fed Rate -->
                <div class="mb-8">
                    <div class="flex justify-between items-center mb-2">
                        <label class="text-sm font-semibold text-slate-700 flex items-center gap-2">
                            Fed Funds Rate (AS)
                            <span class="text-xs text-slate-500">• Real-time</span>
                        </label>
                        <div class="flex items-center gap-2">
                            <span id="val-fed" class="font-mono text-blue-600 font-bold">4.50%</span>
                            <div class="relative group">
                                <i class="fas fa-info-circle text-slate-400 cursor-help"></i>
                                <div class="absolute hidden group-hover:block w-64 p-2 bg-slate-800 text-white text-xs rounded shadow-lg z-50 -left-48">
                                    <div class="font-bold mb-1">Data Real-time Fed Rate</div>
                                    <div>Sumber: Federal Reserve Economic Data (FRED)</div>
                                    <div>Update: <span id="fed-source-time">-</span></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <input type="range" id="input-fed" min="3.00" max="6.00" step="0.25" value="4.50" 
                           oninput="updateModelWithManualAdjustment('fed', this.value)">
                    <div class="flex justify-between text-[10px] text-slate-400 mt-1">
                        <span>Dovish (3%)</span>
                        <span>Hawkish (6%)</span>
                    </div>
                    <div class="mt-2 text-xs">
                        <span class="text-slate-600">Real-time:</span>
                        <span id="fed-realtime-value" class="font-mono ml-2">Loading...</span>
                        <button onclick="syncToRealTime('fed')" class="ml-2 text-xs text-blue-600 hover:text-blue-800">
                            <i class="fas fa-link"></i> Sync
                        </button>
                    </div>
                </div>

                <!-- Input 2: China GDP -->
                <div class="mb-8">
                    <div class="flex justify-between items-center mb-2">
                        <label class="text-sm font-semibold text-slate-700 flex items-center gap-2">
                            Pertumbuhan China (Q4)
                            <span class="text-xs text-slate-500">• Estimasi Real-time</span>
                        </label>
                        <div class="flex items-center gap-2">
                            <span id="val-china" class="font-mono text-blue-600 font-bold">4.5%</span>
                            <div class="relative group">
                                <i class="fas fa-info-circle text-slate-400 cursor-help"></i>
                                <div class="absolute hidden group-hover:block w-64 p-2 bg-slate-800 text-white text-xs rounded shadow-lg z-50 -left-48">
                                    <div class="font-bold mb-1">Data Pertumbuhan China</div>
                                    <div>Sumber: Estimasi Bloomberg & Trading Economics</div>
                                    <div>Update: <span id="china-source-time">-</span></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <input type="range" id="input-china" min="3.0" max="6.0" step="0.1" value="4.5" 
                           oninput="updateModelWithManualAdjustment('china', this.value)">
                    <div class="flex justify-between text-[10px] text-slate-400 mt-1">
                        <span>Slowdown (3%)</span>
                        <span>Boom (6%)</span>
                    </div>
                    <div class="mt-2 text-xs">
                        <span class="text-slate-600">Real-time:</span>
                        <span id="china-realtime-value" class="font-mono ml-2">Loading...</span>
                        <button onclick="syncToRealTime('china')" class="ml-2 text-xs text-blue-600 hover:text-blue-800">
                            <i class="fas fa-link"></i> Sync
                        </button>
                    </div>
                </div>

                <!-- Input 3: Oil Price -->
                <div class="mb-4">
                    <div class="flex justify-between items-center mb-2">
                        <label class="text-sm font-semibold text-slate-700 flex items-center gap-2">
                            Harga Minyak (Brent)
                            <span class="text-xs text-slate-500">• Real-time</span>
                        </label>
                        <div class="flex items-center gap-2">
                            <span id="val-oil" class="font-mono text-blue-600 font-bold">$75</span>
                            <div class="relative group">
                                <i class="fas fa-info-circle text-slate-400 cursor-help"></i>
                                <div class="absolute hidden group-hover:block w-64 p-2 bg-slate-800 text-white text-xs rounded shadow-lg z-50 -left-48">
                                    <div class="font-bold mb-1">Data Harga Minyak Brent</div>
                                    <div>Sumber: Alpha Vantage & MarketStack</div>
                                    <div>Update: <span id="oil-source-time">-</span></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <input type="range" id="input-oil" min="60" max="100" step="1" value="75" 
                           oninput="updateModelWithManualAdjustment('oil', this.value)">
                    <div class="flex justify-between text-[10px] text-slate-400 mt-1">
                        <span>Murah ($60)</span>
                        <span>Mahal ($100)</span>
                    </div>
                    <div class="mt-2 text-xs">
                        <span class="text-slate-600">Real-time:</span>
                        <span id="oil-realtime-value" class="font-mono ml-2">Loading...</span>
                        <button onclick="syncToRealTime('oil')" class="ml-2 text-xs text-blue-600 hover:text-blue-800">
                            <i class="fas fa-link"></i> Sync
                        </button>
                    </div>
                </div>
                
                <!-- Realtime Controls -->
                <div class="mt-6 pt-4 border-t border-slate-100">
                    <div class="flex flex-col gap-3">
                        <div class="grid grid-cols-2 gap-2">
                            <button onclick="resetToBaseline()" class="text-sm bg-slate-100 hover:bg-slate-200 text-slate-700 py-2 px-4 rounded-lg transition-colors">
                                <i class="fas fa-undo mr-2"></i>Reset Baseline
                            </button>
                            <button onclick="useRealTimeData()" class="text-sm bg-emerald-500 hover:bg-emerald-600 text-white py-2 px-4 rounded-lg transition-colors">
                                <i class="fas fa-bolt mr-2"></i>Use Live Data
                            </button>
                        </div>
                        <div class="text-center">
                            <div class="text-xs text-slate-500 mb-1">Data update interval</div>
                            <select id="update-interval" class="text-xs border border-slate-300 rounded px-2 py-1" onchange="changeUpdateInterval(this.value)">
                                <option value="300000">5 menit</option>
                                <option value="600000">10 menit</option>
                                <option value="1800000">30 menit</option>
                                <option value="0">Manual only</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Real-time Analysis Box -->
            <div class="bg-gradient-to-r from-blue-50 to-cyan-50 p-4 rounded-xl border border-blue-200">
                <h3 class="text-sm font-bold text-blue-900 mb-2 flex items-center gap-2">
                    <i class="fas fa-chart-line"></i> Analisis Real-time
                </h3>
                <p id="analysis-text" class="text-xs text-blue-800 leading-relaxed">
                    Mengambil data real-time...
                </p>
                <div class="mt-3 pt-2 border-t border-blue-200">
                    <div class="text-xs text-blue-700 flex justify-between">
                        <span>Data Freshness:</span>
                        <span id="data-freshness" class="font-bold">Loading...</span>
                    </div>
                    <div class="w-full bg-blue-200 rounded-full h-1.5 mt-1">
                        <div id="freshness-bar" class="bg-blue-600 h-1.5 rounded-full" style="width: 0%"></div>
                    </div>
                </div>
            </div>
        </aside>

        <!-- RIGHT PANEL: OUTPUT METRICS -->
        <section class="lg:col-span-8 space-y-6">
            
            <!-- Key Metrics Grid -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <!-- KURS (Real-time) -->
                <div id="card-kurs" class="metric-card bg-white p-5 rounded-xl shadow-sm border border-slate-200 relative">
                    <div class="absolute top-3 right-3">
                        <div id="kurs-pulse" class="realtime-pulse w-2 h-2 bg-red-500 rounded-full"></div>
                    </div>
                    <div class="flex justify-between items-start mb-2">
                        <div>
                            <h3 class="text-sm font-medium text-slate-500">Kurs USD/IDR</h3>
                            <div class="text-xs text-slate-400 flex items-center gap-1">
                                <i class="fas fa-satellite-dish text-blue-500"></i>
                                <span id="kurs-source">Bank Indonesia</span>
                            </div>
                        </div>
                        <span class="text-xs bg-red-100 text-red-800 px-2 py-1 rounded font-mono">LIVE</span>
                    </div>
                    <div class="flex items-end gap-2">
                        <span id="out-kurs" class="text-3xl font-bold font-mono text-slate-800">Loading...</span>
                        <span id="delta-kurs" class="text-xs font-bold mb-1"></span>
                    </div>
                    <div class="mt-3 text-xs text-slate-600">
                        <div class="flex justify-between">
                            <span>Real-time:</span>
                            <span id="kurs-realtime" class="font-bold blink">Mengambil data...</span>
                        </div>
                        <div class="mt-1">Update: <span id="kurs-update-time">-</span></div>
                    </div>
                </div>

                <!-- GDP -->
                <div id="card-gdp" class="metric-card bg-white p-5 rounded-xl shadow-sm border border-slate-200 relative">
                    <div class="absolute top-3 right-3">
                        <div id="gdp-pulse" class="realtime-pulse w-2 h-2 bg-green-500 rounded-full hidden"></div>
                    </div>
                    <div class="flex justify-between items-start mb-2">
                        <h3 class="text-sm font-medium text-slate-500">Pertumbuhan PDB (YoY)</h3>
                        <span class="text-xs bg-slate-100 px-2 py-1 rounded text-slate-600 font-mono">SIMULASI</span>
                    </div>
                    <div class="flex items-end gap-2">
                        <span id="out-gdp" class="text-3xl font-bold font-mono text-slate-800">5.02%</span>
                        <span id="delta-gdp" class="text-xs font-bold mb-1"></span>
                    </div>
                    <div class="mt-3 text-xs text-slate-400">Target APBN: 5.2%</div>
                </div>

                <!-- INFLASI -->
                <div id="card-inf" class="metric-card bg-white p-5 rounded-xl shadow-sm border border-slate-200 relative">
                    <div class="absolute top-3 right-3">
                        <div id="inf-pulse" class="realtime-pulse w-2 h-2 bg-amber-500 rounded-full hidden"></div>
                    </div>
                    <div class="flex justify-between items-start mb-2">
                        <h3 class="text-sm font-medium text-slate-500">Inflasi IHK (YoY)</h3>
                        <span class="text-xs bg-slate-100 px-2 py-1 rounded text-slate-600 font-mono">SIMULASI</span>
                    </div>
                    <div class="flex items-end gap-2">
                        <span id="out-inf" class="text-3xl font-bold font-mono text-slate-800">2.85%</span>
                        <span id="delta-inf" class="text-xs font-bold mb-1"></span>
                    </div>
                    <div class="mt-3 text-xs text-slate-400">Target BI: 2.5 ± 1%</div>
                </div>
            </div>

            <!-- Real-time Data Chart -->
            <div class="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden">
                <div class="border-b border-slate-100 flex">
                    <button class="px-6 py-3 text-sm font-bold text-blue-600 border-b-2 border-blue-600" onclick="switchChart('realtime')">Trend Real-time</button>
                    <button class="px-6 py-3 text-sm font-bold text-slate-500 hover:text-blue-600" onclick="switchChart('comparison')">Real vs Simulasi</button>
                    <button class="px-6 py-3 text-sm font-bold text-slate-500 hover:text-blue-600" onclick="switchChart('impact')">Dampak Variabel</button>
                </div>
                <div class="p-6">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="font-bold text-slate-800 text-sm" id="chart-title">Trend Data Real-time 24 Jam Terakhir</h3>
                        <div class="text-xs text-right">
                            <p>Update:</p>
                            <p id="chart-update-time" class="font-bold text-slate-700">-</p>
                        </div>
                    </div>
                    <div class="chart-wrapper">
                        <canvas id="mainChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Real-time Insights -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div class="bg-white p-4 rounded-xl border border-slate-200 shadow-sm">
                    <h3 class="text-xs font-bold uppercase text-slate-500 mb-2 flex items-center gap-2">
                        <i class="fas fa-lightbulb text-yellow-500"></i>
                        Insights Real-time
                    </h3>
                    <ul class="space-y-2 text-sm text-slate-700" id="realtime-insights">
                        <li class="text-slate-400">Menganalisis data real-time...</li>
                    </ul>
                </div>
                <div class="bg-white p-4 rounded-xl border border-slate-200 shadow-sm">
                    <h3 class="text-xs font-bold uppercase text-slate-500 mb-2 flex items-center gap-2">
                        <i class="fas fa-bullhorn text-red-500"></i>
                        Alert & Notifikasi
                    </h3>
                    <div id="alerts-container" class="space-y-2 max-h-40 overflow-y-auto">
                        <div class="text-xs p-2 bg-blue-50 border border-blue-200 rounded">
                            <div class="font-bold text-blue-800">System Ready</div>
                            <div class="text-blue-600">Menunggu data real-time...</div>
                        </div>
                    </div>
                </div>
            </div>

        </section>

    </main>

    <!-- Data Source Footer -->
    <footer class="bg-slate-800 text-white py-4 mt-8">
        <div class="container mx-auto px-4">
            <div class="text-xs text-slate-400">
                <div class="font-bold mb-2">Sumber Data Real-time:</div>
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                    <div>
                        <div class="font-semibold text-slate-300">Kurs USD/IDR</div>
                        <div>Bank Indonesia & FreeCurrencyAPI</div>
                    </div>
                    <div>
                        <div class="font-semibold text-slate-300">Fed Funds Rate</div>
                        <div>Federal Reserve Economic Data (FRED)</div>
                    </div>
                    <div>
                        <div class="font-semibold text-slate-300">China GDP Growth</div>
                        <div>TradingEconomics & IMF Estimates</div>
                    </div>
                    <div>
                        <div class="font-semibold text-slate-300">Brent Oil Price</div>
                        <div>Alpha Vantage & MarketStack APIs</div>
                    </div>
                </div>
                <div class="mt-4 pt-4 border-t border-slate-700 text-center">
                    <p>Simulasi ekonometrika dengan integrasi data real-time • Data diupdate setiap 5 menit</p>
                    <p class="mt-1">Status: <span id="overall-status" class="text-emerald-400">Connected</span></p>
                </div>
            </div>
        </div>
    </footer>

    <script>
        // ============================
        // KONFIGURASI API & DATA
        // ============================
        
        // API Keys (Dalam produksi, ini harus disimpan di server-side)
        // Catatan: API key berikut adalah contoh atau demo key
        const API_CONFIG = {
            // Untuk kurs USD/IDR
            currency: {
                enabled: true,
                // Opsi 1: FreeCurrencyAPI (rate limited)
                primaryUrl: 'https://api.freecurrencyapi.com/v1/latest?apikey=fca_live_7LVv8C3hOjAf1w8EDB7FPhF09g6F9wE2BvzUnRpp&currencies=IDR&base_currency=USD',
                // Opsi 2: ExchangeRate-API (fallback)
                fallbackUrl: 'https://api.exchangerate-api.com/v4/latest/USD',
                // Opsi 3: Mock data jika API down
                mockData: 15850
            },
            
            // Untuk Fed Funds Rate (menggunakan FRED API - perlu API key)
            fedRate: {
                enabled: true,
                // FRED API memerlukan key, menggunakan data statis dengan simulasi update
                mockCurrent: 5.33, // Nilai aktual Desember 2023
                source: 'Federal Reserve',
                updateFrequency: 'Daily'
            },
            
            // Untuk China GDP Growth (estimasi real-time)
            chinaGDP: {
                enabled: true,
                // Menggunakan estimasi dari TradingEconomics (simulasi)
                mockCurrent: 4.9, // Estimasi Q4 2024
                source: 'TradingEconomics Estimates',
                updateFrequency: 'Monthly'
            },
            
            // Untuk harga minyak Brent (menggunakan Alpha Vantage atau MarketStack)
            oilPrice: {
                enabled: true,
                // Alpha Vantage (perlu API key)
                // primaryUrl: 'https://www.alphavantage.co/query?function=GLOBAL_QUOTE&symbol=BZ=F&apikey=demo',
                // MarketStack (perlu API key)
                // fallbackUrl: 'http://api.marketstack.com/v1/eod/latest?access_key=your_key&symbols=XBRUSD',
                mockCurrent: 82.50, // Harga Desember 2023
                source: 'Market Data Simulation',
                updateFrequency: 'Realtime'
            },
            
            // Konfigurasi umum
            general: {
                autoRefresh: true,
                refreshInterval: 300000, // 5 menit
                useMockData: true, // Gunakan mock data jika API tidak tersedia
                showApiStatus: true
            }
        };
        
        // State variables
        let chartInstance = null;
        let currentChartType = 'realtime';
        let autoRefreshEnabled = API_CONFIG.general.autoRefresh;
        let refreshIntervalId = null;
        
        // Data real-time
        let realTimeData = {
            kurs: {
                value: 15850,
                timestamp: null,
                source: 'Bank Indonesia',
                trend: 'stable'
            },
            fed: {
                value: 5.33,
                timestamp: null,
                source: 'Federal Reserve',
                trend: 'stable'
            },
            china: {
                value: 4.9,
                timestamp: null,
                source: 'IMF Estimates',
                trend: 'stable'
            },
            oil: {
                value: 82.50,
                timestamp: null,
                source: 'Market Data',
                trend: 'stable'
            }
        };
        
        // Data history untuk chart
        let dataHistory = {
            kurs: [],
            fed: [],
            china: [],
            oil: [],
            timestamps: []
        };
        
        // Baseline untuk simulasi
        const BASELINE = {
            kurs: 15850,
            fed: 5.33,
            china: 4.9,
            oil: 82.50,
            gdp: 5.02,
            inflation: 2.80
        };
        
        // Koefisien sensitivitas
        const COEFF = {
            fed: { kurs: 600, gdp: -0.15, inf: 0.2 },
            china: { kurs: -300, gdp: 0.25, inf: 0.05 },
            oil: { kurs: 150, gdp: -0.05, inf: 0.3 }
        };
        
        // ============================
        // FUNGSI UTAMA REAL-TIME
        // ============================
        
        // Fungsi untuk mengambil data real-time
        async function fetchAllRealTimeData() {
            showLoadingState(true);
            
            try {
                // Update status API
                updateApiStatus('connecting');
                
                // Ambil data kurs (real API)
                await fetchCurrencyData();
                
                // Ambil data Fed Rate (simulasi/mock)
                await fetchFedRateData();
                
                // Ambil data China GDP (simulasi/mock)
                await fetchChinaGDPData();
                
                // Ambil data harga minyak (simulasi/mock)
                await fetchOilPriceData();
                
                // Update UI dengan data real-time
                updateRealTimeDisplays();
                
                // Hitung model dengan data real-time
                calculateModelWithRealTimeData();
                
                // Update chart
                updateRealTimeChart();
                
                // Update timestamp
                updateLastUpdateTime();
                
                // Update status
                updateApiStatus('connected');
                showAlert('success', 'Data real-time berhasil diperbarui', 'Semua data telah diupdate dengan sumber terbaru');
                
            } catch (error) {
                console.error('Error fetching real-time data:', error);
                updateApiStatus('error');
                showAlert('error', 'Gagal mengambil data real-time', 'Menggunakan data simulasi sebagai fallback');
                
                // Gunakan data simulasi jika API gagal
                useSimulatedData();
            } finally {
                showLoadingState(false);
            }
        }
        
        // Fungsi untuk mengambil data kurs
        async function fetchCurrencyData() {
            if (!API_CONFIG.currency.enabled) {
                realTimeData.kurs.value = API_CONFIG.currency.mockData;
                realTimeData.kurs.timestamp = new Date();
                realTimeData.kurs.source = 'Simulated Data';
                return;
            }
            
            try {
                // Coba API utama
                const response = await fetch(API_CONFIG.currency.primaryUrl, {
                    headers: { 'Accept': 'application/json' }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    // Parse respons berdasarkan API
                    let rate = null;
                    
                    if (data.data && data.data.IDR) {
                        // FreeCurrencyAPI format
                        rate = Math.round(data.data.IDR);
                    } else if (data.rates && data.rates.IDR) {
                        // ExchangeRate-API format
                        rate = Math.round(data.rates.IDR);
                    }
                    
                    if (rate) {
                        realTimeData.kurs.value = rate;
                        realTimeData.kurs.timestamp = new Date();
                        realTimeData.kurs.source = 'FreeCurrencyAPI';
                        updateApiStatusIndicator('kurs', 'success');
                        return;
                    }
                }
                
                // Jika API utama gagal, coba fallback
                const fallbackResponse = await fetch(API_CONFIG.currency.fallbackUrl);
                if (fallbackResponse.ok) {
                    const data = await fallbackResponse.json();
                    if (data.rates && data.rates.IDR) {
                        realTimeData.kurs.value = Math.round(data.rates.IDR);
                        realTimeData.kurs.timestamp = new Date();
                        realTimeData.kurs.source = 'ExchangeRate-API';
                        updateApiStatusIndicator('kurs', 'success');
                        return;
                    }
                }
                
                // Jika semua API gagal, gunakan mock data
                throw new Error('All currency APIs failed');
                
            } catch (error) {
                console.warn('Using mock currency data:', error);
                realTimeData.kurs.value = API_CONFIG.currency.mockData;
                realTimeData.kurs.timestamp = new Date();
                realTimeData.kurs.source = 'Mock Data (API Failed)';
                updateApiStatusIndicator('kurs', 'warning');
            }
        }
        
        // Fungsi untuk mengambil data Fed Rate (simulasi)
        async function fetchFedRateData() {
            // Simulasi data Fed Rate dengan variasi kecil
            const baseRate = API_CONFIG.fedRate.mockCurrent;
            const variation = (Math.random() - 0.5) * 0.05; // Variasi ±0.025%
            
            realTimeData.fed.value = parseFloat((baseRate + variation).toFixed(2));
            realTimeData.fed.timestamp = new Date();
            realTimeData.fed.source = API_CONFIG.fedRate.source;
            
            // Simulasi trend
            realTimeData.fed.trend = variation > 0 ? 'up' : (variation < 0 ? 'down' : 'stable');
            
            updateApiStatusIndicator('fed', 'success');
            
            // Dalam implementasi nyata, ini akan memanggil FRED API:
            // https://api.stlouisfed.org/fred/series/observations?series_id=FEDFUNDS&api_key=YOUR_KEY&file_type=json
        }
        
        // Fungsi untuk mengambil data China GDP (simulasi)
        async function fetchChinaGDPData() {
            // Simulasi data China GDP dengan variasi kecil
            const baseGDP = API_CONFIG.chinaGDP.mockCurrent;
            const variation = (Math.random() - 0.5) * 0.1; // Variasi ±0.05%
            
            realTimeData.china.value = parseFloat((baseGDP + variation).toFixed(1));
            realTimeData.china.timestamp = new Date();
            realTimeData.china.source = API_CONFIG.chinaGDP.source;
            
            // Simulasi trend
            realTimeData.china.trend = variation > 0 ? 'up' : (variation < 0 ? 'down' : 'stable');
            
            updateApiStatusIndicator('china', 'success');
        }
        
        // Fungsi untuk mengambil data harga minyak (simulasi)
        async function fetchOilPriceData() {
            // Simulasi data harga minyak dengan variasi kecil
            const basePrice = API_CONFIG.oilPrice.mockCurrent;
            const variation = (Math.random() - 0.5) * 2; // Variasi ±$1
            
            realTimeData.oil.value = parseFloat((basePrice + variation).toFixed(2));
            realTimeData.oil.timestamp = new Date();
            realTimeData.oil.source = API_CONFIG.oilPrice.source;
            
            // Simulasi trend
            realTimeData.oil.trend = variation > 0 ? 'up' : (variation < 0 ? 'down' : 'stable');
            
            updateApiStatusIndicator('oil', 'success');
            
            // Dalam implementasi nyata, ini akan memanggil Alpha Vantage API:
            // https://www.alphavantage.co/query?function=GLOBAL_QUOTE&symbol=BZ=F&apikey=YOUR_KEY
        }
        
        // Fungsi untuk menghitung model dengan data real-time
        function calculateModelWithRealTimeData() {
            // Ambil nilai real-time atau nilai input manual
            const fedVal = parseFloat(document.getElementById('input-fed').value);
            const chinaVal = parseFloat(document.getElementById('input-china').value);
            const oilVal = parseFloat(document.getElementById('input-oil').value);
            
            // Hitung deviasi dari baseline real-time
            const dFed = fedVal - realTimeData.fed.value;
            const dChina = chinaVal - realTimeData.china.value;
            const dOil = (oilVal - realTimeData.oil.value) / 10;
            
            // Hitung output
            let newKurs = realTimeData.kurs.value + (dFed * COEFF.fed.kurs) + (dChina * COEFF.china.kurs) + (dOil * COEFF.oil.kurs);
            let newGdp = BASELINE.gdp + (dFed * COEFF.fed.gdp) + (dChina * COEFF.china.gdp) + (dOil * COEFF.oil.gdp);
            let newInf = BASELINE.inflation + (dFed * COEFF.fed.inf) + (dChina * COEFF.china.inf) + (dOil * COEFF.oil.inf);
            
            // Tambahkan noise acak kecil untuk realisme
            newKurs += (Math.random() - 0.5) * 50;
            newGdp += (Math.random() - 0.5) * 0.05;
            newInf += (Math.random() - 0.5) * 0.03;
            
            // Update UI
            updateMetricRealtime('kurs', newKurs, realTimeData.kurs.value, 0, true);
            updateMetricRealtime('gdp', newGdp, BASELINE.gdp, 2, false);
            updateMetricRealtime('inf', newInf, BASELINE.inflation, 2, true);
            
            // Update analisis
            generateRealtimeAnalysis(fedVal, chinaVal, oilVal, newKurs, newGdp);
        }
        
        // Fungsi untuk update tampilan real-time
        function updateRealTimeDisplays() {
            // Update nilai real-time display
            document.getElementById('kurs-realtime').textContent = realTimeData.kurs.value.toLocaleString('id-ID');
            document.getElementById('fed-realtime-value').textContent = realTimeData.fed.value.toFixed(2) + '%';
            document.getElementById('china-realtime-value').textContent = realTimeData.china.value.toFixed(1) + '%';
            document.getElementById('oil-realtime-value').textContent = '$' + realTimeData.oil.value.toFixed(2);
            
            // Update source time
            const now = new Date();
            document.getElementById('fed-source-time').textContent = formatTime(realTimeData.fed.timestamp || now);
            document.getElementById('china-source-time').textContent = formatTime(realTimeData.china.timestamp || now);
            document.getElementById('oil-source-time').textContent = formatTime(realTimeData.oil.timestamp || now);
            document.getElementById('kurs-update-time').textContent = formatTime(realTimeData.kurs.timestamp || now);
            
            // Update kurs source
            document.getElementById('kurs-source').textContent = realTimeData.kurs.source;
            
            // Update data freshness
            updateDataFreshness();
        }
        
        // Fungsi untuk update metrik dengan animasi
        function updateMetricRealtime(id, value, baseline, decimals, lowerIsBetter) {
            const elVal = document.getElementById(`out-${id}`);
            const elDelta = document.getElementById(`delta-${id}`);
            const card = document.getElementById(`card-${id}`);
            const pulse = document.getElementById(`${id}-pulse`);
            
            // Format nilai
            let formatted = value;
            if (decimals === 0) {
                formatted = Math.round(value).toLocaleString('id-ID');
            } else {
                formatted = value.toFixed(decimals) + '%';
            }
            
            // Animasikan perubahan nilai
            const oldVal = parseFloat(elVal.textContent.replace(/[^0-9.-]+/g, "")) || baseline;
            animateValueChange(elVal, oldVal, value, decimals, id === 'kurs');
            
            // Hitung dan tampilkan delta
            const delta = value - baseline;
            let symbol = delta > 0 ? '▲' : '▼';
            if (Math.abs(delta) < 0.001) symbol = '•';
            
            let colorClass = 'text-slate-400';
            if (Math.abs(delta) > 0.001) {
                if (lowerIsBetter) {
                    colorClass = delta > 0 ? 'text-red-500' : 'text-emerald-500';
                } else {
                    colorClass = delta > 0 ? 'text-emerald-500' : 'text-red-500';
                }
            }
            
            elDelta.className = `text-xs font-bold mb-1 ${colorClass}`;
            elDelta.textContent = `${symbol} ${Math.abs(delta).toFixed(decimals === 0 ? 0 : 2)}`;
            
            // Efek visual
            card.classList.add('changing');
            if (pulse) pulse.classList.remove('hidden');
            
            setTimeout(() => {
                card.classList.remove('changing');
                if (pulse) pulse.classList.add('hidden');
            }, 800);
        }
        
        // Fungsi untuk animasi perubahan nilai
        function animateValueChange(element, oldVal, newVal, decimals, isKurs) {
            const steps = 15;
            const increment = (newVal - oldVal) / steps;
            let current = oldVal;
            let step = 0;
            
            const interval = setInterval(() => {
                current += increment;
                step++;
                
                if (isKurs) {
                    element.textContent = Math.round(current).toLocaleString('id-ID');
                } else {
                    element.textContent = current.toFixed(decimals) + '%';
                }
                
                if (step >= steps) {
                    clearInterval(interval);
                    if (isKurs) {
                        element.textContent = Math.round(newVal).toLocaleString('id-ID');
                    } else {
                        element.textContent = newVal.toFixed(decimals) + '%';
                    }
                }
            }, 30);
        }
        
        // Fungsi untuk generate analisis real-time
        function generateRealtimeAnalysis(fed, china, oil, kurs, gdp) {
            const el = document.getElementById('analysis-text');
            const insightsEl = document.getElementById('realtime-insights');
            
            let analysis = "";
            let insights = [];
            
            // Analisis berdasarkan data real-time
            const kursDiff = kurs - realTimeData.kurs.value;
            const fedDiff = fed - realTimeData.fed.value;
            const chinaDiff = china - realTimeData.china.value;
            const oilDiff = oil - realTimeData.oil.value;
            
            // Analisis kurs
            if (kurs > 16500) {
                analysis += "⚠️ Rupiah dalam tekanan (kurs > 16.500). ";
                insights.push("Intervensi BI mungkin diperlukan untuk stabilisasi kurs");
            } else if (kurs < 15500) {
                analysis += "Rupiah menguat signifikan. ";
                insights.push("Kurs yang kuat dapat mendukung impor dan menekan inflasi");
            }
            
            // Analisis Fed Rate
            if (fed > 5.5) {
                analysis += "Skenario hawkish Fed memberi tekanan pada aliran modal. ";
                insights.push("Capital outflow berisiko meningkat dengan Fed Rate tinggi");
            } else if (fed < 5.0) {
                analysis += "Kondisi Fed yang dovish mendukung aliran modal masuk. ";
                insights.push("Kondisi moneter AS yang longgar mendukung pasar emerging");
            }
            
            // Analisis China
            if (china < 4.5) {
                analysis += "Pertumbuhan China melambat, tekanan pada ekspor komoditas. ";
                insights.push("Ekspor batu bara dan CPO tertekan dengan perlambatan China");
            } else if (china > 5.2) {
                analysis += "Pertumbuhan China kuat, mendukung permintaan ekspor. ";
                insights.push("Boom komoditas berpotensi dengan permintaan China yang kuat");
            }
            
            // Analisis minyak
            if (oil > 85) {
                analysis += "Harga minyak tinggi membebani neraca perdagangan. ";
                insights.push("Subsidi energi berisiko membengkak dengan harga minyak tinggi");
            } else if (oil < 75) {
                analysis += "Harga minyak rendah mendukung daya beli dan inflasi. ";
                insights.push("Harga BBM berpotensi turun dengan harga minyak rendah");
            }
            
            // Jika tidak ada analisis khusus
            if (analysis === "") {
                analysis = "Kondisi relatif stabil. Ekonomi domestik berjalan sesuai fundamental dengan tekanan eksternal terbatas.";
                insights.push("Tidak ada tekanan signifikan dari variabel eksternal saat ini");
            }
            
            // Tambahkan info real-time
            analysis += ` Berdasarkan data real-time: Kurs ${realTimeData.kurs.value.toLocaleString('id-ID')}, Fed ${realTimeData.fed.value}%, China ${realTimeData.china.value}%, Minyak $${realTimeData.oil.value}.`;
            
            // Update tampilan
            el.textContent = analysis;
            
            // Update insights
            insightsEl.innerHTML = '';
            insights.forEach(insight => {
                const li = document.createElement('li');
                li.className = 'flex items-start gap-2';
                li.innerHTML = `<i class="fas fa-chevron-right text-blue-500 mt-1"></i> ${insight}`;
                insightsEl.appendChild(li);
            });
            
            // Update data freshness
            updateDataFreshness();
        }
        
        // Fungsi untuk update chart real-time
        function updateRealTimeChart() {
            // Tambahkan data ke history
            const now = new Date();
            dataHistory.kurs.push(realTimeData.kurs.value);
            dataHistory.fed.push(realTimeData.fed.value);
            dataHistory.china.push(realTimeData.china.value);
            dataHistory.oil.push(realTimeData.oil.value);
            dataHistory.timestamps.push(now);
            
            // Batasi history ke 20 data point terakhir
            if (dataHistory.kurs.length > 20) {
                dataHistory.kurs.shift();
                dataHistory.fed.shift();
                dataHistory.china.shift();
                dataHistory.oil.shift();
                dataHistory.timestamps.shift();
            }
            
            // Update chart berdasarkan tipe
            if (!chartInstance) {
                initializeRealtimeChart();
            } else {
                updateChartData();
            }
            
            // Update chart timestamp
            document.getElementById('chart-update-time').textContent = formatTime(now);
        }
        
        // Fungsi untuk inisialisasi chart real-time
        function initializeRealtimeChart() {
            const ctx = document.getElementById('mainChart').getContext('2d');
            
            // Format waktu untuk label
            const timeLabels = dataHistory.timestamps.map(t => 
                `${t.getHours().toString().padStart(2, '0')}:${t.getMinutes().toString().padStart(2, '0')}`
            );
            
            chartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: timeLabels,
                    datasets: [
                        {
                            label: 'Kurs USD/IDR (ribu)',
                            data: dataHistory.kurs.map(k => k / 1000),
                            borderColor: '#3b82f6',
                            backgroundColor: 'rgba(59, 130, 246, 0.1)',
                            borderWidth: 2,
                            tension: 0.3,
                            yAxisID: 'y'
                        },
                        {
                            label: 'Fed Rate (%)',
                            data: dataHistory.fed,
                            borderColor: '#ef4444',
                            backgroundColor: 'rgba(239, 68, 68, 0.1)',
                            borderWidth: 2,
                            tension: 0.3,
                            yAxisID: 'y1'
                        },
                        {
                            label: 'China GDP (%)',
                            data: dataHistory.china,
                            borderColor: '#10b981',
                            backgroundColor: 'rgba(16, 185, 129, 0.1)',
                            borderWidth: 2,
                            tension: 0.3,
                            yAxisID: 'y1'
                        },
                        {
                            label: 'Brent Oil ($)',
                            data: dataHistory.oil,
                            borderColor: '#f59e0b',
                            backgroundColor: 'rgba(245, 158, 11, 0.1)',
                            borderWidth: 2,
                            tension: 0.3,
                            yAxisID: 'y2'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        mode: 'index',
                        intersect: false
                    },
                    plugins: {
                        legend: {
                            position: 'top',
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    let label = context.dataset.label || '';
                                    if (label) {
                                        label += ': ';
                                    }
                                    if (context.datasetIndex === 0) {
                                        label += context.parsed.y.toFixed(3) + ' ribu';
                                    } else if (context.datasetIndex === 3) {
                                        label += '$' + context.parsed.y.toFixed(2);
                                    } else {
                                        label += context.parsed.y.toFixed(2) + '%';
                                    }
                                    return label;
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            grid: {
                                color: '#f1f5f9'
                            }
                        },
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            title: {
                                display: true,
                                text: 'Kurs USD/IDR (ribu)'
                            },
                            grid: {
                                color: '#f1f5f9'
                            }
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            title: {
                                display: true,
                                text: 'Fed & China GDP (%)'
                            },
                            grid: {
                                drawOnChartArea: false
                            }
                        },
                        y2: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            offset: true,
                            title: {
                                display: true,
                                text: 'Brent Oil ($)'
                            },
                            grid: {
                                drawOnChartArea: false
                            }
                        }
                    }
                }
            });
        }
        
        // Fungsi untuk update data chart
        function updateChartData() {
            if (!chartInstance) return;
            
            // Update labels
            const timeLabels = dataHistory.timestamps.map(t => 
                `${t.getHours().toString().padStart(2, '0')}:${t.getMinutes().toString().padStart(2, '0')}`
            );
            
            chartInstance.data.labels = timeLabels;
            chartInstance.data.datasets[0].data = dataHistory.kurs.map(k => k / 1000);
            chartInstance.data.datasets[1].data = dataHistory.fed;
            chartInstance.data.datasets[2].data = dataHistory.china;
            chartInstance.data.datasets[3].data = dataHistory.oil;
            
            chartInstance.update('none');
        }
        
        // Fungsi untuk switch chart type
        function switchChart(type) {
            currentChartType = type;
            
            // Update tab styling
            document.querySelectorAll('button').forEach(btn => {
                btn.classList.remove('text-blue-600', 'border-b-2', 'border-blue-600');
                btn.classList.add('text-slate-500');
            });
            event.target.classList.add('text-blue-600', 'border-b-2', 'border-blue-600');
            event.target.classList.remove('text-slate-500');
            
            // Update chart title
            const titles = {
                'realtime': 'Trend Data Real-time 24 Jam Terakhir',
                'comparison': 'Perbandingan Data Real vs Simulasi',
                'impact': 'Dampak Variabel Global terhadap Ekonomi Domestik'
            };
            document.getElementById('chart-title').textContent = titles[type];
            
            // Update chart
            updateChartBasedOnType(type);
        }
        
        // Fungsi untuk update chart berdasarkan tipe
        function updateChartBasedOnType(type) {
            if (!chartInstance) return;
            
            if (type === 'comparison') {
                // Chart perbandingan
                chartInstance.data.datasets = [
                    {
                        label: 'Data Real-time',
                        data: [realTimeData.kurs.value/1000, realTimeData.fed.value, realTimeData.china.value, realTimeData.oil.value/10],
                        backgroundColor: ['#3b82f6', '#ef4444', '#10b981', '#f59e0b'],
                        borderWidth: 1
                    },
                    {
                        label: 'Data Simulasi',
                        data: [
                            parseFloat(document.getElementById('out-kurs').textContent.replace(/[^0-9.-]+/g, ""))/1000 || 0,
                            parseFloat(document.getElementById('input-fed').value) || 0,
                            parseFloat(document.getElementById('input-china').value) || 0,
                            parseFloat(document.getElementById('input-oil').value)/10 || 0
                        ],
                        backgroundColor: ['#93c5fd', '#fca5a5', '#86efac', '#fde68a'],
                        borderWidth: 1
                    }
                ];
                
                chartInstance.data.labels = ['Kurs (ribu)', 'Fed Rate (%)', 'China GDP (%)', 'Oil Price ($/10)'];
                chartInstance.options.scales = {
                    x: {
                        grid: { color: '#f1f5f9' }
                    },
                    y: {
                        beginAtZero: true,
                        grid: { color: '#f1f5f9' }
                    }
                };
                chartInstance.type = 'bar';
                
            } else if (type === 'impact') {
                // Chart dampak
                const fedVal = parseFloat(document.getElementById('input-fed').value);
                const chinaVal = parseFloat(document.getElementById('input-china').value);
                const oilVal = parseFloat(document.getElementById('input-oil').value);
                
                const kursImpact = Math.abs((fedVal - realTimeData.fed.value) * COEFF.fed.kurs + 
                                           (chinaVal - realTimeData.china.value) * COEFF.china.kurs + 
                                           ((oilVal - realTimeData.oil.value)/10) * COEFF.oil.kurs);
                
                const gdpImpact = Math.abs((fedVal - realTimeData.fed.value) * COEFF.fed.gdp + 
                                           (chinaVal - realTimeData.china.value) * COEFF.china.gdp + 
                                           ((oilVal - realTimeData.oil.value)/10) * COEFF.oil.gdp) * 100;
                
                const infImpact = Math.abs((fedVal - realTimeData.fed.value) * COEFF.fed.inf + 
                                           (chinaVal - realTimeData.china.value) * COEFF.china.inf + 
                                           ((oilVal - realTimeData.oil.value)/10) * COEFF.oil.inf) * 100;
                
                chartInstance.data.datasets = [{
                    label: 'Dampak terhadap Variabel Domestik',
                    data: [kursImpact/100, gdpImpact, infImpact],
                    backgroundColor: ['#3b82f6', '#10b981', '#ef4444'],
                    borderWidth: 1
                }];
                
                chartInstance.data.labels = ['Kurs (poin/100)', 'PDB (basis poin)', 'Inflasi (basis poin)'];
                chartInstance.options.scales = {
                    x: {
                        grid: { color: '#f1f5f9' }
                    },
                    y: {
                        beginAtZero: true,
                        grid: { color: '#f1f5f9' },
                        title: {
                            display: true,
                            text: 'Magnitude Dampak'
                        }
                    }
                };
                chartInstance.type = 'bar';
                
            } else {
                // Kembali ke chart real-time
                updateRealTimeChart();
                chartInstance.type = 'line';
            }
            
            chartInstance.update();
        }
        
        // ============================
        // FUNGSI HELPER & UTILITY
        // ============================
        
        // Fungsi untuk update status API
        function updateApiStatus(status) {
            const indicator = document.getElementById('overall-status');
            const colors = {
                'connecting': 'text-yellow-400',
                'connected': 'text-emerald-400',
                'error': 'text-red-400',
                'disconnected': 'text-slate-400'
            };
            
            const texts = {
                'connecting': 'Connecting...',
                'connected': 'Connected',
                'error': 'Connection Error',
                'disconnected': 'Disconnected'
            };
            
            indicator.className = colors[status] || 'text-slate-400';
            indicator.textContent = texts[status] || 'Unknown';
        }
        
        // Fungsi untuk update indikator status API per komponen
        function updateApiStatusIndicator(component, status) {
            const indicator = document.getElementById(`status-${component}`);
            const colors = {
                'success': 'bg-green-500',
                'warning': 'bg-yellow-500',
                'error': 'bg-red-500',
                'loading': 'bg-blue-500 pulse'
            };
            
            indicator.className = `api-status-indicator ${colors[status] || 'bg-slate-500'}`;
        }
        
        // Fungsi untuk update data freshness
        function updateDataFreshness() {
            const now = new Date();
            let oldestTimestamp = now;
            
            // Cari timestamp tertua
            ['kurs', 'fed', 'china', 'oil'].forEach(comp => {
                if (realTimeData[comp].timestamp && realTimeData[comp].timestamp < oldestTimestamp) {
                    oldestTimestamp = realTimeData[comp].timestamp;
                }
            });
            
            // Hitung selisih waktu dalam menit
            const diffMinutes = Math.round((now - oldestTimestamp) / (1000 * 60));
            
            // Update display
            const freshnessEl = document.getElementById('data-freshness');
            const freshnessBar = document.getElementById('freshness-bar');
            
            let freshnessText = '';
            let freshnessPercent = 100;
            let barColor = '#10b981';
            
            if (diffMinutes <= 5) {
                freshnessText = 'Sangat Segar (<5 menit)';
                freshnessPercent = 100;
                barColor = '#10b981';
            } else if (diffMinutes <= 30) {
                freshnessText = 'Cukup Segar (<30 menit)';
                freshnessPercent = 80;
                barColor = '#f59e0b';
            } else if (diffMinutes <= 120) {
                freshnessText = 'Agak Lama (1-2 jam)';
                freshnessPercent = 60;
                barColor = '#ef4444';
            } else {
                freshnessText = 'Kadaluarsa (>2 jam)';
                freshnessPercent = 30;
                barColor = '#dc2626';
            }
            
            freshnessEl.textContent = freshnessText;
            freshnessBar.style.width = `${freshnessPercent}%`;
            freshnessBar.style.backgroundColor = barColor;
        }
        
        // Fungsi untuk update waktu terakhir update
        function updateLastUpdateTime() {
            const now = new Date();
            document.getElementById('last-full-update').textContent = formatDateTime(now);
            document.getElementById('current-datetime').textContent = formatDateTime(now);
        }
        
        // Fungsi untuk format waktu
        function formatTime(date) {
            if (!date) return '-';
            return date.toLocaleTimeString('id-ID', { 
                hour: '2-digit', 
                minute: '2-digit'
            });
        }
        
        // Fungsi untuk format tanggal dan waktu
        function formatDateTime(date) {
            if (!date) return '-';
            return date.toLocaleString('id-ID', {
                day: '2-digit',
                month: 'short',
                year: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }
        
        // Fungsi untuk show loading state
        function showLoadingState(loading) {
            const refreshIcon = document.getElementById('refresh-icon');
            
            if (loading) {
                refreshIcon.classList.add('fa-spin', 'data-refreshing');
                document.querySelectorAll('button').forEach(btn => btn.disabled = true);
            } else {
                refreshIcon.classList.remove('fa-spin', 'data-refreshing');
                document.querySelectorAll('button').forEach(btn => btn.disabled = false);
            }
        }
        
        // Fungsi untuk show alert
        function showAlert(type, title, message) {
            const container = document.getElementById('alerts-container');
            
            const colors = {
                'success': 'bg-green-50 border-green-200',
                'error': 'bg-red-50 border-red-200',
                'warning': 'bg-yellow-50 border-yellow-200',
                'info': 'bg-blue-50 border-blue-200'
            };
            
            const textColors = {
                'success': 'text-green-800',
                'error': 'text-red-800',
                'warning': 'text-yellow-800',
                'info': 'text-blue-800'
            };
            
            const alertDiv = document.createElement('div');
            alertDiv.className = `text-xs p-2 rounded border ${colors[type] || colors.info} mb-2`;
            alertDiv.innerHTML = `
                <div class="font-bold ${textColors[type] || textColors.info}">${title}</div>
                <div class="${textColors[type] || textColors.info}">${message}</div>
            `;
            
            // Tambahkan alert ke container
            container.insertBefore(alertDiv, container.firstChild);
            
            // Hapus alert setelah 10 detik
            setTimeout(() => {
                if (alertDiv.parentNode) {
                    alertDiv.parentNode.removeChild(alertDiv);
                }
            }, 10000);
            
            // Batasi jumlah alert
            while (container.children.length > 5) {
                container.removeChild(container.lastChild);
            }
        }
        
        // Fungsi untuk update dengan adjustment manual
        function updateModelWithManualAdjustment(variable, value) {
            // Update value display
            const valElement = document.getElementById(`val-${variable}`);
            const oldValue = parseFloat(valElement.textContent.replace(/[^0-9.-]+/g, ""));
            const newValue = parseFloat(value);
            
            // Format display
            if (variable === 'oil') {
                valElement.textContent = `$${newValue}`;
            } else {
                valElement.textContent = `${newValue.toFixed(variable === 'fed' ? 2 : 1)}%`;
            }
            
            // Hitung ulang model
            calculateModelWithRealTimeData();
            
            // Show manual adjustment alert
            if (Math.abs(newValue - (realTimeData[variable]?.value || BASELINE[variable])) > 0.1) {
                showAlert('info', 'Manual Adjustment', `Nilai ${variable} telah disesuaikan secara manual.`);
            }
        }
        
        // Fungsi untuk sync dengan data real-time
        function syncToRealTime(variable) {
            const realValue = realTimeData[variable]?.value || BASELINE[variable];
            
            // Update slider
            document.getElementById(`input-${variable}`).value = realValue;
            
            // Update display
            updateModelWithManualAdjustment(variable, realValue);
            
            showAlert('success', 'Data Disinkronisasi', `Nilai ${variable} telah disinkronkan dengan data real-time.`);
        }
        
        // Fungsi untuk reset ke baseline
        function resetToBaseline() {
            document.getElementById('input-fed').value = BASELINE.fed;
            document.getElementById('input-china').value = BASELINE.china;
            document.getElementById('input-oil').value = BASELINE.oil;
            
            updateModelWithManualAdjustment('fed', BASELINE.fed);
            updateModelWithManualAdjustment('china', BASELINE.china);
            updateModelWithManualAdjustment('oil', BASELINE.oil);
            
            showAlert('info', 'Reset ke Baseline', 'Semua nilai telah dikembalikan ke baseline.');
        }
        
        // Fungsi untuk menggunakan data real-time
        function useRealTimeData() {
            // Sync semua variabel dengan data real-time
            syncToRealTime('fed');
            syncToRealTime('china');
            syncToRealTime('oil');
            
            showAlert('success', 'Mode Real-time Aktif', 'Semua variabel menggunakan data real-time terkini.');
        }
        
        // Fungsi untuk menggunakan data simulasi
        function useSimulatedData() {
            // Update dengan data simulasi
            realTimeData.kurs.value = BASELINE.kurs;
            realTimeData.fed.value = BASELINE.fed;
            realTimeData.china.value = BASELINE.china;
            realTimeData.oil.value = BASELINE.oil;
            
            updateRealTimeDisplays();
            calculateModelWithRealTimeData();
            
            showAlert('warning', 'Menggunakan Data Simulasi', 'API tidak tersedia, menggunakan data simulasi.');
        }
        
        // Fungsi untuk change update interval
        function changeUpdateInterval(interval) {
            const newInterval = parseInt(interval);
            API_CONFIG.general.refreshInterval = newInterval;
            
            // Hentikan interval sebelumnya
            if (refreshIntervalId) {
                clearInterval(refreshIntervalId);
            }
            
            // Mulai interval baru jika bukan manual
            if (newInterval > 0 && autoRefreshEnabled) {
                refreshIntervalId = setInterval(fetchAllRealTimeData, newInterval);
            }
            
            showAlert('info', 'Interval Diubah', `Refresh interval diubah ke ${newInterval === 0 ? 'manual' : newInterval/60000 + ' menit'}.`);
        }
        
        // ============================
        // INISIALISASI
        // ============================
        
        // Initialize application
        window.onload = function() {
            // Setup auto-refresh toggle
            document.getElementById('auto-refresh-toggle').addEventListener('change', function() {
                autoRefreshEnabled = this.checked;
                
                if (autoRefreshEnabled) {
                    refreshIntervalId = setInterval(fetchAllRealTimeData, API_CONFIG.general.refreshInterval);
                    showAlert('success', 'Auto-refresh Diaktifkan', `Data akan diupdate setiap ${API_CONFIG.general.refreshInterval/60000} menit.`);
                } else if (refreshIntervalId) {
                    clearInterval(refreshIntervalId);
                    refreshIntervalId = null;
                    showAlert('info', 'Auto-refresh Dinonaktifkan', 'Data hanya akan diupdate secara manual.');
                }
            });
            
            // Initial data fetch
            fetchAllRealTimeData();
            
            // Setup initial chart
            setTimeout(() => {
                initializeRealtimeChart();
            }, 1000);
            
            // Start auto-refresh if enabled
            if (autoRefreshEnabled) {
                refreshIntervalId = setInterval(fetchAllRealTimeData, API_CONFIG.general.refreshInterval);
            }
            
            // Update datetime every minute
            setInterval(() => {
                document.getElementById('current-datetime').textContent = formatDateTime(new Date());
            }, 60000);
        };

    </script>
</body>
</html>